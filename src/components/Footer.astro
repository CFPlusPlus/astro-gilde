---
import { hrefFor } from '../lib/links';
import { minecraftGilde } from '../config/minecraftGilde';
const year = new Date().getFullYear();

const repoUrl = minecraftGilde.repoUrl || import.meta.env.GIT_REPO_URL || '';
const commitHash = import.meta.env.GIT_COMMIT_HASH || '';
const shortCommit = commitHash ? commitHash.slice(0, 7) : '';
const showCommit = Boolean(commitHash && commitHash !== 'dev');
const commitHref =
  repoUrl && commitHash && commitHash !== 'dev' ? `${repoUrl}/commit/${commitHash}` : '';

// Repo-Label (owner/repo) aus der URL ableiten, damit wir das gewünschte Format anzeigen können.
// Fallback: Falls parsing fehlschlägt, zeigen wir einfach "GitHub".
let repoLabel = 'GitHub';
try {
  if (repoUrl) {
    const url = new URL(repoUrl);
    const cleaned = url.pathname.replace(/^\/+|\/+$/g, '');
    const parts = cleaned.split('/').filter(Boolean);
    if (parts.length >= 2) repoLabel = `${parts[0]}/${parts[1]}`;
  }
} catch {
  // Ignorieren: Repo-URL ist evtl. kein gültiger URL-String.
}

const LINKS = [
  { href: '/datenschutz/', label: 'Datenschutz' },
  { href: '/impressum/', label: 'Impressum' },
  { href: '/team/', label: 'Team' },
  { href: 'https://discord.minecraft-gilde.de', label: 'Discord', external: true },
  { href: 'https://map.minecraft-gilde.de', label: 'Dynmap', external: true },
];
---

<footer class="w-full">
  <div class="border-border/70 bg-surface/60 border-t backdrop-blur-md">
    <div class="mx-auto max-w-6xl px-4 py-10">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div class="text-muted text-sm">
          © {year}
          <span class="text-fg/90 font-medium">Christian Falkner</span>
          <span class="text-fg/60"> · Minecraft Gilde</span>
        </div>

        <div class="flex flex-col gap-2 sm:items-end">
          <nav aria-label="Footer" class="flex flex-wrap gap-x-4 gap-y-2 text-sm sm:justify-end">
            {
              LINKS.map((l) => (
                <a
                  href={hrefFor(l.href)}
                  target={l.external ? '_blank' : undefined}
                  rel={l.external ? 'noopener noreferrer' : undefined}
                  class="text-fg/80 hover:text-fg hover:decoration-accent/60 underline decoration-transparent underline-offset-4 transition-colors"
                >
                  {l.label}
                </a>
              ))
            }
          </nav>

          {
            repoUrl ? (
              <div class="text-fg/60 text-xs sm:text-right">
                <a
                  href={hrefFor(repoUrl)}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:text-fg hover:decoration-accent/50 underline decoration-transparent underline-offset-4 transition-colors"
                >
                  {repoLabel}
                </a>

                {showCommit ? (
                  <>
                    <span aria-hidden="true"> {' @ '} </span>
                    {commitHref ? (
                      <a
                        href={hrefFor(commitHref)}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="hover:text-fg hover:decoration-accent/50 underline decoration-transparent underline-offset-4 transition-colors"
                      >
                        {shortCommit || commitHash}
                      </a>
                    ) : (
                      <span>{shortCommit || commitHash}</span>
                    )}
                  </>
                ) : null}
              </div>
            ) : null
          }
        </div>
      </div>

      <p class="text-muted mt-4 text-xs">
        Wir sind weder mit Mojang AB noch mit Microsoft verbunden.
      </p>
    </div>
  </div>
</footer>
